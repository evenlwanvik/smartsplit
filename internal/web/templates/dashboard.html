{{ define "content" }}
<section class="hero" id="suggestion" hx-get="/suggestion" hx-trigger="load" hx-target="#suggestion" hx-swap="outerHTML">
    <div class="big">Today's suggestion</div>
    <div class="muted">Based on your last plans and muscle cooldowns.</div>
    {{ template "_suggestion.html" .Suggestion }}
</section>
<div class="grid" style="margin-top:1rem;">
    <section class="grid" style="grid-template-columns:1fr;">
        <article class="card">
            <header style="display:flex; justify-content:space-between; align-items:center;">
                <strong>New workout</strong>
            </header>

            <button onclick="document.getElementById('new-workout-modal').showModal()">
                New workout
            </button>

            <!-- Modal -->
            <dialog id="new-workout-modal">
                <article>
                    <header style="display:flex;justify-content:space-between;align-items:center;">
                        <strong>Create workout</strong>
                        <button onclick="this.closest('dialog').close()" aria-label="Close">✕</button>
                    </header>

                    <!-- This body swaps between Step 1 and Step 2 -->
                    <div id="modal-body">
                        <!-- Step 1: choose muscles -->
                        <form
                                hx-post="/plans/new"
                                hx-target="#modal-body"
                                hx-swap="innerHTML">
                            <fieldset>
                                <legend class="big">Select muscles</legend>
                                <div class="chips">
                                    {{ range .Muscles }}  <!-- server provided list -->
                                    <label class="chip">
                                        <input type="checkbox" name="muscles" value="{{ .ID }}">
                                        {{ .Name }}
                                    </label>
                                    {{ end }}
                                </div>
                            </fieldset>
                            <footer style="display:flex; gap:.5rem; justify-content:flex-end;">
                                <button type="button" onclick="this.closest('dialog').close()">Cancel</button>
                                <button type="submit">Continue</button>
                            </footer>
                        </form>
                    </div>
                </article>
            </dialog>
        </article>
        <article class="card">
            <header><strong>Recent activity</strong></header>
            <ol id="recent-plans" class="list-unstyled" hx-get="/plans/recent" hx-trigger="load" hx-swap="innerHTML">
                <li class="muted">Loading…</li>
            </ol>
            <footer><a href="/history">See history →</a></footer>
        </article>
    </section>
    <aside class="grid" style="grid-template-columns:1fr;">
        <article class="card">
            <header><strong>Recently trained muscles</strong></header>
            <div class="chips" id="recent-muscles" hx-get="/muscles/recent" hx-trigger="load, every 30s" hx-swap="outerHTML">
                {{ template "_muscle_chips.html" .RecentMuscles }}
            </div>
        </article>
        <article class="card">
            <header><strong>This week</strong></header>
            <ul class="list-unstyled">
                <li><span class="muted">Sessions</span> <strong>{{ .KPI.Sessions }}</strong></li>
                <li><span class="muted">Unique muscles</span> <strong>{{ .KPI.UniqueMuscles }}</strong></li>
                <li><span class="muted">Run volume</span> <strong>{{ .KPI.RunKM }} km</strong></li>
            </ul>
        </article>
    </aside>
</div>
{{ end }}
{{ define "dashboard.html" }}
{{ template "base" . }}   <!-- renders base, which now pulls in the defined content -->
{{ end }}